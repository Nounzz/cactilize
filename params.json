{"name":"Cactilize","tagline":"Ansible playbook for deploying and maintaining cacti server and host (graph, devices, templates, tree ...)","body":"# Cactilize\r\n\r\nAnsible role and playbook for deploying and maintaining cacti server and host (graph, devices, templates, tree)\r\n\r\nTravis CI [![Build Status](https://travis-ci.org/helldorado/cactilize.png?branch=master)](https://travis-ci.org/helldorado/cactilize)\r\n---------------------\r\n\r\nTravis CI is a continuous integration service used by this repo (see [.travis.yml](https://github.com/helldorado/cactilize/blob/master/.travis.yml) for details).\r\n\r\nOn every new pull request or commit, Travis CI will run a series of checks on the repo.\r\n\r\nSee [https://travis-ci.org/helldorado/cactilize](https://travis-ci.org/helldorado/cactilize)\r\n\r\n## Summary\r\n\r\n* [Definitions](#definitions)\r\n* [Description](#description)\r\n* [Requirements](#requirements)\r\n* [Host template and Graph Dictionary](#host-template-and-graph-dictionary)\r\n* [Installation](#installation)\r\n* [QuickStart](#QuickStart)\r\n  - [Install and bootstrap an cacti server instance](#install-and-bootstrap-an-cacti-server-instance)\r\n  - [Ready to fire ? GO !](#ready-to-fire?-go-!)\r\n  - [Tips](#tips)\r\n* [Development](#development)\r\n* [Credits](#credits)\r\n* [Licence](#licence)\r\n* [References](#references)\r\n\r\n## Definitions\r\n\r\nIn the following :\r\n\r\n - The **Server** is the host where **cacti server** is installed. Cacti is a complete network graphing solution designed to harness the power of [*RRDTool's*](http://www.rrdtool.org/) data storage and graphing functionality. Cacti provides a fast poller, advanced graph templating, multiple data acquisition methods, and user management features out of the box. All of this is wrapped in an intuitive, easy to use interface that makes sense for LAN-sized installations up to complex networks with hundreds of devices.\r\n \r\n\t ![cacti](http://www.cacti.net/images/cacti_promo_main.png)\r\n \r\n - The **Cacti client** A device, be anything which can be monitored remotely or locally. This can include storage devices, Windows or UNIX servers, and of course network devices. For Cacti to be able to monitor a device, it needs to be reachable by ping or SNMP, but the actual data retrieval can also be done using scripts and commands, or a set of SNMP queries.\r\n\r\n\r\n## Requirements\r\n\r\n - [Ansible](http://www.ansibleworks.com) installed and ready to work. If not and you have [puppet](http://puppetlabs.com/) master in you architecure, I highly recommend the [nvogel/ansible](http://forge.puppetlabs.com/nvogel/ansible) Module.\r\n\r\n - MySQL 5.x or greater and ensure you have set a auto-login for root by creating a `/root/.my.cnf` on 0400 mode and put this 3 lines according your mysql server configuration. \r\n\r\n```bash\r\n[client]\r\nuser=root\r\nhost=localhost\r\npassword='You mysql server root password'\r\n```\r\n\r\n> This role is created for Debian (Squeeze/Wheezy) and compatible with ***ansible 1.6 and ansible 1.7***.\r\n\r\n## Host template and Graph Dictionary\r\n\r\n- [Apache Server HT](https://github.com/helldorado/cactilize/blob/master/vars/def/apache_def.yml)\r\n- [Elasticsearch Host](https://github.com/helldorado/cactilize/blob/master/vars/def/elasticsearch_def.yml)\r\n- [Galera Server HT](https://github.com/helldorado/cactilize/blob/master/vars/def/galera_def.yml)\r\n- [Nginx Server HT](https://github.com/helldorado/cactilize/blob/master/vars/def/nginx_def.yml)\r\n- [Memcached Server HT](https://github.com/helldorado/cactilize/blob/master/vars/def/memcache_def.yml)\r\n- [MongoDB Server HT](https://github.com/helldorado/cactilize/blob/master/vars/def/mongodb_def.yml)\r\n- [MySQL Server HT](https://github.com/helldorado/cactilize/blob/master/vars/def/mysql_def.yml)\r\n- [Redis Server HT](https://github.com/helldorado/cactilize/blob/master/vars/def/redis_def.yml)\r\n- [Varnish Cache](https://github.com/helldorado/cactilize/blob/master/vars/def/varnish_def.yml)\r\n- [ucd/net SNMP Host](https://github.com/helldorado/cactilize/blob/master/vars/def/system_def.yml)\r\n\r\n> *For more info about definitions dictionary and howto to modify or add your own definitions dictionnary please refere to the [wiki page](https://github.com/helldorado/cactilize/wiki)*\r\n\r\n## Installation\r\n\r\nFrom Ansible Galaxy :\r\n```bash\r\nsu - ansible\r\n$ ansible-galaxy install helldorado.cactilize\r\n```\r\nOr with [Librarian ansible](https://github.com/bcoe/librarian-ansible), for example add to your **Ansiblefile** :\r\n\r\n```\r\nrole \"cactilize\", :git => \"https://github.com/helldorado/cactilize\"\r\n:ref => '0.1'\r\n```\r\nAnd update your roles\r\n```bash\r\n$ librarian-ansible update\r\n```\r\n\r\n## QuickStart\r\n\r\n### Install and bootstrap an cacti server instance \r\n\r\n### Examples :\r\nPlease edit these files before run the playbook.\r\n\r\n- The ansible host file: `cactilize`\r\n\r\n\r\n```ini\r\n### cacti server\r\n[server] \r\nspymedia\r\n\r\n### Client to graph\r\n[client]\r\nspyweb[1:8]\r\nspycache[1:3]\r\nspybdd1[1:2]\r\nspywatch1\r\nspymail\r\n```\r\n- The playbook file: `cactilize.yml` /!\\ PLEASE ! Do not edit this file, unless you know what you are doing\r\n\r\n\r\n```yaml\r\n# File: cactilize.yml\r\n# Description:\r\n# Playbook for cactilize\r\n#\r\n# OS: Debian6 debian7\r\n\r\n---\r\n    - hosts: all\r\n      user: ansible\r\n      sudo: True\r\n      \r\n      vars_files:\r\n        - roles/cactilize/vars/deploy.yml\r\n        - roles/cactilize/vars/templates.yml\r\n        - roles/cactilize/vars/hosts.yml\r\n        - roles/cactilize/vars/users.yml\r\n        - roles/cactilize/vars/trees.yml\r\n        - roles/cactilize/vars/def/mysql_def.yml\r\n        - roles/cactilize/vars/def/elasticsearch_def.yml\r\n        - roles/cactilize/vars/def/system_def.yml\r\n        - roles/cactilize/vars/def/varnish_def.yml\r\n        - roles/cactilize/vars/def/memcache_def.yml\r\n        - roles/cactilize/vars/def/apache_def.yml\r\n        - roles/cactilize/vars/def/redis_def.yml\r\n        - roles/cactilize/vars/def/mongodb_def.yml\r\n        - roles/cactilize/vars/def/galera_def.yml\r\n        - roles/cactilize/vars/def/nginx_def.yml\r\n\r\n      roles:\r\n       - cactilize\r\n\r\n ```\r\n \r\n- The deploy vars file: `roles/cactilize/vars/deploy.yml`\r\n\r\n```yaml\r\n---\r\n### DEPLOIEMENT \r\ndeploy                : false\r\nwebui_admin_user      : helldorado\r\nwebui_admin_password  : 2A2169234F6BC1360CFC29EEF8\r\narchi_name            : spy\r\narchi_subnet          : '10.0.2'\r\ndefault_community     : spynol\r\ncacti_db_hostname     : localhost\r\ncacti_db_password     : tNSimlfnER7d6\r\ncacti_mysql_mon_user  : monitoring\r\ncacti_mysql_mon_pass  : 4vtYd5axfavQo\r\n#domain_name          : spynol.info\r\nRRA_VG_NAME           : system\r\n#RRA_LV_NAME          : var_lib_rra\r\nRRA_LV_SIZE           : 5G\r\nRRA_MOUNT_POINT       : '/var/lib/rra'\r\nDEFAULT_IP            : 'x.x.x.0/24'\r\nWHITELIST             : 'x.x.x.1/32 y.y.y.2/32 z.z.z.0/16'\r\n\r\n### HTPASSWD USERS\r\nhtpasswd_users:\r\n  spyadm:\r\n    passwd: tSuMCNaKvASaU \r\n  spycombo:\r\n    passwd: YbXpnONCIG9V2\r\n```\r\n- The host (devices) vars file:  `roles/cactilize/vars/hosts.yml`\r\n\r\n```yaml\r\n---\r\nHosts:\r\n  'spyweb1':\r\n    IP   : 10.0.2.11\r\n    graph: \r\n      - system\r\n      - nginx\r\n      - apache\r\n    tree : LEMP\r\n\r\n  'spybdd1':\r\n    IP   : 10.0.2.51\r\n    graph:\r\n      - system\r\n      - mysql\r\n      - memcache\r\n      - redis\r\n      - mongodb\r\n    tree : Mysql\r\n    notes: 'Database Server'\r\n  \r\n  'spycache1':\r\n    IP   : 10.0.2.16\r\n    graph: \r\n      - system\r\n      - varnish\r\n      - memcache\r\n      - galera\r\n    tree : Varnish\r\n    notes: 'Cache Server'\r\n  \r\n  'spywatch':\r\n    IP   : 10.0.2.40\r\n    graph: \r\n      - system\r\n      - elasticsearch\r\n      - redis\r\n    tree : ES\r\n    notes: 'Elasticsearch server'\r\n  \r\n  'spymail':\r\n    IP   : 10.0.2.70\r\n    graph: \r\n      - system\r\n      - postfix\r\n    tree : Mail\r\n    notes: 'Mail Server'\r\n```\r\n- The tree vars file: `roles/cactilize/vars/trees.yml`\r\n\r\n\r\n```yaml\r\n---\r\n\r\n## TREE SERVICE HOST BASED\r\n#tree_mode          : host_by_role\r\ntree_mode         : graph_by_role\r\n#tree_mode          : mixed\r\nparentnode_host    : HOSTS\r\nparentnode_service : SERVICES\r\n\r\n\r\n## HOST BY ROLES\r\nTree_Mode_Host:\r\n \r\n - node: \"{{ parentnode_host }}\"\r\n   subnodes:\r\n     -\r\n\r\n - node: LVS\r\n   subnodes:\r\n     -\r\n\r\n - node: WEB\r\n   subnodes:\r\n     - Nginx\r\n     - Apache\r\n     - Litghttpd\r\n\r\n - node: CACHE\r\n   subnodes:\r\n     - Varnish\r\n \r\n - node: DATABASES\r\n   subnodes:\r\n     - Mysql\r\n     - Galera\r\n     - Postgresql\r\n\r\n - node: NoSQL\r\n   subnodes:\r\n     - Redis\r\n     - Memcache\r\n     - Mongodb\r\n     - ES\r\n \r\n - node: LAMP\r\n   subnodes:\r\n      -\r\n\r\n - node: LEMP\r\n   subnodes:\r\n      -\r\n\r\n## GRAPH BY ROLE\r\nTree_Mode_Graph:\r\n\r\n - node: \"{{ parentnode_service }}\"\r\n   subnodes:\r\n     -\r\n\r\n - node: WEB\r\n   subnodes:\r\n     - NGINX\r\n     - APACHE\r\n     - LIGHTTPD\r\n\r\n - node: CACHE\r\n   subnodes:\r\n     - VARNISH\r\n     - OPCODE\r\n\r\n - node: DATABASES\r\n   subnodes:\r\n     - MYSQL\r\n     - GALERA\r\n\r\n - node: NoSQL\r\n   subnodes:\r\n     - REDIS\r\n     - MEMCACHE\r\n     - MONGODB\r\n     - ES\r\n\r\n - node: SYSTEM\r\n   subnodes:\r\n     - NETWORK\r\n     - CPU\r\n     - MEMORY\r\n     - DISK\r\n```  \r\n\r\n- The users vars file: `roles/cactilize/vars/users.yml`\r\n\r\n```yaml\r\n---\r\n ## WEBUI User Permissions\r\nUsers:\r\n\r\n  'spyviewer':\r\n    password            : FleninOfAt\r\n    full_name           : 'SPY Viewer'\r\n    enabled             : 'on'\r\n    must_change_password:\r\n    permissions         :\r\n      - View_Graphs\r\n      - Export_Data\r\n    policy              :\r\n      - View_Graphs\r\n      - View_Tree\r\n```\r\n\r\n\r\n\r\n**/!\\  For the other vars files, PLEASE ‼️ Do not edit setting unless you know what you are doing**\r\n\r\n\r\n> You can create several devices, tree and users.\r\n\r\n\r\n### Ready to fire ? GO ! \r\n\r\n - Step 1 :: Deploy cacti server \r\n\r\n```bash\r\nansible-playbook cactilize.yml -i cactilize --limit server -extra-vars deploy=true\r\n```\r\n\r\nThis will take some time according your devices and graph list, be patient...\r\n\r\n- Step 2 :: Configure your client to send information via SNMP, Scripts and others to the cacti server.\r\n\r\n```bash\r\nansible-playbook cactilize.yml -i cactilize --limit client\r\n```\r\n\r\n- Step 3 :: check the report file `/root/.cacti` in you cacti server. For example\r\n\r\n```\r\n-- ************************** WARNING CACTILIZE ANSIBLE PLAYBOOK ********************************\r\n-- File Managed by Ansible\r\n-- Any changes to this report file  should be done trough ansible\r\n-- other wise report will be overwriten on te next ansible cactilize deploy pass.\r\n-- **********************************************************************************************\r\n\r\n  /$$$$$$                        /$$     /$$ /$$ /$$\r\n /$$__  $$                      | $$    |__/| $$|__/\r\n| $$  \\__/  /$$$$$$   /$$$$$$$ /$$$$$$   /$$| $$ /$$ /$$$$$$$$  /$$$$$$\r\n| $$       |____  $$ /$$_____/|_  $$_/  | $$| $$| $$|____ /$$/ /$$__  $$\r\n| $$        /$$$$$$$| $$        | $$    | $$| $$| $$   /$$$$/ | $$$$$$$$\r\n| $$    $$ /$$__  $$| $$        | $$ /$$| $$| $$| $$  /$$__/  | $$_____/\r\n|  $$$$$$/|  $$$$$$$|  $$$$$$$  |  $$$$/| $$| $$| $$ /$$$$$$$$|  $$$$$$$\r\n \\______/  \\_______/ \\_______/   \\___/  |__/|__/|__/|________/ \\_______/\r\n\r\n\r\n[ACCESS]\r\n   URL   => http://IP_PUB/cacti , https://IP_PUB/cacti (according your server and archi configuration)\r\n\r\n   - WebUI\r\n       Administrator:\r\n          Login  => helldorado\r\n          Pass   => 2A2169234F6BC1360CFC29EEF8\r\n\r\n       SPY Viewer:\r\n          Login  => spyviewer\r\n          Pass   => FleninOfAt\r\n\r\n\r\n/!\\ Please for nginx server, put this line in your default virtual host:\r\n\r\ninclude /etc/nginx/conf.d/status.conf ;\r\n\r\nAnd reload nginx:\r\n\r\nnginx -t && service nginx reload\r\n```\r\n\r\n\r\n## Tips\r\n- Allways use and ABUSE **TAGs** \r\n\r\n| List of Tags  | Description | File|\r\n| ------------- | ------------- |--------\r\n|   device      | Create all device  | task/devices.yml \r\n|   graph       | Create all graph |task/graph.yml| \r\n|   graph-system| Create only system graph|\r\n|   graph-mysql | Create only mysql graph |\r\n|  graph-mongodb|Create only mongodb graph|\r\n- If possible or necessary  start from a specific task \r\n\r\n```bash\r\nansible-playbook cactilize.yml -i cactilize --limit client --start-at-task \"SNMP CONF\"\r\n``` \r\n\r\n## Development\r\n\r\n### Bugs and feature requests\r\n\r\nHave a bug or a feature request? Please first check the list of issues.\r\n\r\nIf your problem or idea is not addressed yet, please open a new issue, or contact me at [devops@helldorado.info](devops@helldorado.info)\r\n\r\n### Contributing\r\n\r\nYou're welcome to propose pull requests. Here's a quick guide.\r\n\r\nFork, then clone the repo:\r\n\r\n    git clone git@github.com:your-username/cactilize\r\n\r\nSet up your ansible environement for test suite.\r\n\r\nMake sure the tests pass:\r\n\r\nMake your change. Add examples and documentation for your change. \r\nPush to your fork and [submit a pull request](https://github.com/helldorado/cactilize/compare/).\r\n\r\n\r\nSome things that will increase the chance that your pull request is accepted:\r\n\r\n* Write tests, see Travis CI section or/and ansible [Testing Strategies](http://docs.ansible.com/test_strategies.html)\r\n* Follow ansible playbook best pratices [style guide]().\r\n* Write a [good commit message](http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html).\r\n\r\n\r\n## Credits\r\n\r\n* **Abdoul Bah**\r\n* [All contributors](https://github.com/helldorado/cactilize/graphs/contributors)\r\n\r\n## Licence\r\n\r\nCactilize ansible role is released under the GPL2 License. Check the [LICENSE](https://github.com/helldorado/cactilize/blob/master/LICENSE) file for details.\r\n\r\n## References\r\n\r\n- [Ansible](http://www.ansibleworks.com)\r\n- [Ansible Playbook](http://docs.ansible.com/playbooks.html)\r\n- [Ansible Role](http://docs.ansible.com/playbooks_roles.html)\r\n- [Ansible Galaxy](https://galaxy.ansible.com/)\r\n- [YAML Gotchas](http://www.yaml.org/spec/1.2/spec.html)\r\n- [Cacti® - The Complete RRDTool-based Graphing Solution](http://www.cacti.net/)\r\n- [Percona Monitoring Plugins](http://www.percona.com/doc/percona-monitoring-plugins/1.1/)\r\n- [Contributing to open-source](https://guides.github.com/activities/contributing-to-open-source)\r\n- [About commit](https://help.github.com/categories/commits/)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}